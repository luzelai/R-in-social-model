[
["index.html", "基于R语言的社会科学建模 前言", " 基于R语言的社会科学建模 陆泽凯 谢颖 2020-10-21 前言 没有人是一座孤岛，17世纪英国诗人——约翰·多恩的诗句1。在今天数据爆炸的时代更是如此。人与人之间的交流沟通在21世纪的今天变得如此频繁。无论你是否是被动还是主动，我们都必须要和别人交流，获得数据。大数据时代，社会科学工作者常会感觉到迷茫，无所适从。看到了数据背后可能隐藏的宝藏，却手里缺少称心的工具去挖掘。通过这本书，我将介绍一种极其强大的数据挖掘，数据建模工具——R语言。 本书将用R语言目前最流行的语法结构——tidy way进行讲授。tidy way是R语言最著名开发者Hadley Wickham开发的一系列数据清洗，数据可视化的包（dplyr和tidyr以及ggplot等包组成）所衍生的新的R语言语法。这套语法使得R语言变得更易上手，任何人都可以轻松学习！ 本书主要分为两个部分——第一个部分，会通过一份社科数据向大家讲授R语言的基础操作，这部分会教授大家如何导入数据，清洗数据，合并数据并完成数据的初步可视化。通过这一部分，大家就可以通过各种社科数据进行基本的分析加工。 第二个部分，我将讲一些社科量化模型，包括回归分析模型，因子模型，如何通过R语言做主成分分析。之后，我将教大家如何对微博进行简单的文本分析。也许你只听说过用Python进行机器学习。但其实利用R语言也可以进行机器模型的建立。这一部分的最后，我将教大家如何利用前面分析的结果，做出专业的科研绘图，满足科研杂志的需要。 相信通过这本书，大家可以得到一份称心的工具，建立自己的定量科学武器。不再是一座数据的孤岛。 install.packages(&quot;bookdown&quot;) # or the development version # devtools::install_github(&quot;rstudio/bookdown&quot;) Remember each Rmd file contains one and only one chapter, and a chapter is defined by the first-level heading #. To compile this example to PDF, you need XeLaTeX. You are recommended to install TinyTeX (which includes XeLaTeX): https://yihui.org/tinytex/. 包指的是R语言中一些被编写好“包装”在一起的命令。我们可以自己不写命令而直接调用别人写好的命令。↩︎ "],
["入门.html", "章节 1 入门，认识R语言的强大功能 1.1 R能为我们做什么 1.2 R语言下载安装 1.3 R语言环境设置和包的安装", " 章节 1 入门，认识R语言的强大功能 R语言是一门强大的统计学语言，本章我将向大家展示R语言强大的功能，并引导大家完成R语言的基础配置。为后面的章节打下基础。 1.1 R能为我们做什么 R语言能做什么，你也许从你的同学，你的老师中早就听说过R语言的鼎鼎大名，看见别人用R语言轻松的做出漂亮好看的图表，而你自己却只能利用Excel慢慢拖这拖那来慢慢做图。或者说，当你为一个计量经济学的回归模型，挠头苦想时，千方百计才了解到可以用R语言做出这个模型，你却因为R语言是一门编程语言而望而却步。 其实R语言远没有你想象的那么困难，R语言是一门由统计学家创造的语言。它的很多特性与传统的编程语言并不相同，比如它拥有许多内置的统计函数，拥有一个数据框结构。还有它的数据切片是由1开始，而不是像传统的编程语言以0作为切片的开始。上面这些特征都是其他编程语言不具备的。这些特征使得R语言不仅更易上手，也更好满足我们做定量研究的需要。 但另一方面R语言始终都是一门编程语言，它是一门兼顾了面向对象编程和函数式编程的语言。拥有许多标准的程序结构，这些都是传统的R语言中我们必须学习的。而这些对于没有编程背景的社科研究者来说无疑加大了难度 Hadley Wickham开发的一系列用于数据清洗和数据可视化的包2打破了这一困局，在这一系列被称为Tidy(Wickham et al. 2020)的包中我们可以用更加人性化的语言来清洗数据。Hadley Wickham将我们日常生活中的各种动词比如select,filter还有rename作为指令来操作数据，使得这些命令更容易理解，也更加好记。比如我们要选择某个数据表中的1到5列的变量的前5行。用传统的R语言我们应该这样写： head(iris[1:5]) ## Sepal.Length Sepal.Width Petal.Length Petal.Width Species ## 1 5.1 3.5 1.4 0.2 setosa ## 2 4.9 3.0 1.4 0.2 setosa ## 3 4.7 3.2 1.3 0.2 setosa ## 4 4.6 3.1 1.5 0.2 setosa ## 5 5.0 3.6 1.4 0.2 setosa ## 6 5.4 3.9 1.7 0.4 setosa 而在tidy的风格中我们可以这样写 iris %&gt;% select(1,2,3,4,5) %&gt;% head()#或者也可以写成iris %&gt;% select(1:5) %&gt;% head() ## Sepal.Length Sepal.Width Petal.Length Petal.Width Species ## 1 5.1 3.5 1.4 0.2 setosa ## 2 4.9 3.0 1.4 0.2 setosa ## 3 4.7 3.2 1.3 0.2 setosa ## 4 4.6 3.1 1.5 0.2 setosa ## 5 5.0 3.6 1.4 0.2 setosa ## 6 5.4 3.9 1.7 0.4 setosa 显然tidy风格的会更好理解一些——在iris数据中我们select(选择)了1，2，3，4，5行然后打印它的head(顶部)。这样的例子还有很多。对于比较简单的指令传统的R语言可能还比较好理解，但如果我们数据清洗的要求多了起来。那么命令就会很是复杂，没有tidy风格那么直观。我会将一份示例放在附录，读者朋友们可以对比参考。 1.2 R语言下载安装 R可以在CRAN（Comprehensive R Archive Network，http://cran.r-project.org） 上免费下载。进入CRAN的网站后。根据你所选择平台的安装说明进行安装即可。 Figure 1.1: CRAN官网 在安装好R语言后，如果你使用的是Windows，可以从开始菜单中启动R。在Mac上，则需要双击应用程序文件夹中R图标，正式进入R的一个终端环境。但我们现在通常会配备一个Rstudio开发的IDE（集成开发环境）来进行代码编写。它会帮我们进行代码高亮，自动补全，环境配置等等黑科技。 我们可以Rstudio官网（www.rstudio.com）下载IDE。同样选择适合自己操作系统的IDE就可以。安装过程中，Rstudio会自动帮我寻找R的地址。之后我们打开Rstudio就可以快乐的撸代码啦！ Figure 1.2: Rstudio界面 Rstudio界面一般分为四块。左上角是我们写脚本的区域，也是我们平时写代码的地方。右上角是变量储存区，我们可以在这里检查我们的变量，还可以进行git等高级操作。左下角是控制台区域，在这里我们写入代码会被马上执行，可以调试我们代码。右下角是作图区和帮助文档区，我们做的图会显示在那里，我们查看文档和下载包也会在那里。 1.3 R语言环境设置和包的安装 在中国内地时，我们经常会遇见R语言更新和下载包很慢很慢的情况。这是因为，R的默认下载镜像并不在中国。这个时候我们就要设置我们包的镜像在内地。用Rstudio可以很方便的进行设置。点击菜单栏的Tools，再点击Global Options...。然后选择packages就可以更变镜像位置。一般我们选择China (Beijing 1) [https] - TUNA Team, Tsinghua University镜像。Global Options还可以改变字体和界面颜色。大家可以好好摸索。 Figure 1.3: 设置界面 下载包我们可以在命令行区域直接输入 install.packages(&quot;xxx&quot;) 在xxx中输入自己要下载的包比如tidyverse就可以下载了。或者我们也可以通过Global Options里的install Packages进行包的下载。在框中输入自己想要下载的包，然后点击install就可以进行下载。 Figure 1.4: 下载界面 在这本书中我们要下载最重要的包就是tidyverse。tidyverse是tidy语法的集大成者。包括了绘图包ggplot2，数据清理包dplyr，表格关系处理包tidyr等许多实用工具。我们用命令 install.packages(&quot;tidyverse&quot;) 等待命令行重新出现&gt;就可以完成安装，之后用命令 library(tidyverse) 如果出现上面的代码，即表示你安装已经成功。（tidyverse体积比较大，要耐心等待） 引用 "],
["导入社科数据.html", "章节 2 导入社科数据 2.1 R语言管道输入法 2.2 运算符介绍", " 章节 2 导入社科数据 Figure 2.1: hadoop标志 2.1 R语言管道输入法 在本书中，我不会重点阐述R语言的一些编程范式和编程技巧，只会有需要时才会向大家讲解。不过R语言中有一些编程的方法是不得不讲清楚的。 第一是，R语言tidy语法中的管道输入法。tidy语法引入了UNIX系统上的管道，可以写出更加清晰的代码。管道就是将上一行代码块的内容作为参数传入到下一行代码块中。在R语言中管道用%&gt;%表示，比如说我们要查看iris数据前20行各个叶片的平均值，并同时要求按不同种类输出。传统的R语法你可以这样写 library(tidyverse) summarise_if(group_by(head(iris,20),Species),is_numeric,mean) ## # A tibble: 1 x 5 ## Species Sepal.Length Sepal.Width Petal.Length Petal.Width ## &lt;fct&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 setosa 5.04 3.48 1.44 0.235 是不是特别复杂，看得云里雾里，通过管道语法可以很好的解决这个问题，用了管道%&gt;%后你可以这样写 #library(tidyverse) iris %&gt;% head(20) %&gt;% group_by(Species) %&gt;% summarise_if(is.numeric,mean) ## # A tibble: 1 x 5 ## Species Sepal.Length Sepal.Width Petal.Length Petal.Width ## &lt;fct&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 setosa 5.04 3.48 1.44 0.235 我们可以用自然语言法的办法来理解%&gt;%比如上面的代码几乎可以读成iris先（%&gt;%）展示它的前20行（head(20)），然后（%&gt;%）再按Species分类（group_by(Species)），最后（%&gt;%）聚合（summarise_if）如果是数字（is.numeric）则计算平均数（mean） 记住管道的作用就是把上个代码计算的结果作为第一个参数带到第二块代码中。在tidy语法中利用管道是一件非常常见的事情。 2.2 运算符介绍 R语言中的运算符。R语言中运算符基本分为算术运算符，逻辑判断运算符，赋值运算符。下面简单介绍一下， 算术运算符就是进行加减乘除以及各种高级元素的符号，下表是R语言中常用的算术运算符表格。需要注意得是R语言在做算术元素时，是以逐元素为基础得。这并不符合矩阵运算得特征。R语言中如果要做矩阵的乘法要用%*%来计算。如果是按原始的*来计算得到的是个个相对应元素相乘的积。 运算符 描述 示例 + 两个向量相加 v &lt;- c( 2,5.5,6) t &lt;- c(8, 3, 4) print(v+t)它产生以下结果：[1] 10.0 8.5 10.0 − 从第一个向量减去第二个向量 v &lt;- c( 2,5.5,6) t &lt;- c(8, 3, 4) print(v-t)它产生以下结果：[1] -6.0 2.5 2.0 * 两个矢量相乘 v &lt;- c( 2,5.5,6) t &lt;- c(8, 3, 4) print(v*t)它产生以下结果：[1] 16.0 16.5 24.0 / 将第一个向量与第二向量相除 v &lt;- c( 2,5.5,6) t &lt;- c(8, 3, 4) print(v/t)它产生以下结果：[1] 0.250000 1.833333 1.500000 %% 得到第一矢量与第二个矢量余数 v &lt;- c( 2,5.5,6) t &lt;- c(8, 3, 4) print(v%%t)它产生以下结果：[1] 2.0 2.5 2.0 ^ 第一向量提升到第二向量的指数 v &lt;- c( 2,5.5,6) t &lt;- c(8, 3, 4) print(v^t)它产生以下结果：[1] 256.000 166.375 1296.000 关系运算符涉及的是R语言中的逻辑判断。它运算的结果会返回一个布尔值TRUE或者FALSE。下面的表格列出了常用的一些逻辑判断运算符。 运算符 描述 示例 &gt; 检查是否第一向量的每个元素大于第二向量的相应元素。 v &lt;- c(2,5.5,6,9) t &lt;- c(8,2.5,14,9) print(v&gt;t)它产生以下结果： [1] FALSE TRUE FALSE FALSE &lt; 检查是否第一向量的每个元素小于第二向量的相应元素。 v &lt;- c(2,5.5,6,9) t &lt;- c(8,2.5,14,9) print(v &lt; t)它产生以下结果：[1] TRUE FALSE TRUE FALSE == 检查是否第一向量的每个元素等于第二向量的相应元素。 v &lt;- c(2,5.5,6,9) t &lt;- c(8,2.5,14,9) print(v==t)它产生以下结果：[1] FALSE FALSE FALSE TRUE &lt;= 检查是否第一向量的每个元素是小于或等于第二向量的相应的元素。 v &lt;- c(2,5.5,6,9) t &lt;- c(8,2.5,14,9) print(v&lt;=t)它产生以下结果：[1] TRUE FALSE TRUE TRUE &gt;= 检查是否第一向量的每个元素是大于或等于第二向量的相应元素。 v &lt;- c(2,5.5,6,9) t &lt;- c(8,2.5,14,9) print(v&gt;=t)它产生以下结果：[1] FALSE TRUE FALSE TRUE != 检查是否第一向量的每个元素不等于第二向量的相应元素。 v &lt;- c(2,5.5,6,9) t &lt;- c(8,2.5,14,9) print(v!=t)它产生以下结果：[1] TRUE TRUE TRUE FALSE &amp; 这就是所谓的元素逻辑AND运算符。它结合与第二向量的相应元素的第一向量的每个元素，如果这两个元件都为TRUE则给出一个TRUE。 v &lt;- c(3,1,TRUE,2+3i) t &lt;- c(4,1,FALSE,2+3i) print(v&amp;t)它产生以下结果：[1] TRUE TRUE FALSE TRUE | 这就是所谓的逐元素逻辑或运算符。它结合与第二向量的相应元素的第一向量的每个元素，如果使用这些元素之一为TRUE则给出一个TRUE。 v &lt;- c(3,0,TRUE,2+2i) t &lt;- c(4,0,FALSE,2+3i) print(v|t)它产生以下结果：[1] TRUE FALSE TRUE TRUE ! 这就是所谓的逻辑非运算符。取向量的每个元素，并给出了相反逻辑值。 v &lt;- c(3,0,TRUE,2+2i) print(!v)它产生以下结果：[1] FALSE TRUE FALSE FALSE 而对于赋值运算符，R语言除了提供类似与其他编程语言=等于号赋值外，还提供了-&gt;以及&lt;-的赋值符号。这几乎和=号的赋值功能是相同的，大家可以根据自己的喜好进行选择。 最后R语言还有一些高级的赋值运算符比如%in%用来识别一个元素是否属于（在）一个向量。:可以用来创建一组序列,如1:10创建1到10，十个数。 1:10#等效于seq() ## [1] 1 2 3 4 5 6 7 8 9 10 seq(1,10) ## [1] 1 2 3 4 5 6 7 8 9 10 "],
["数据清洗入门.html", "章节 3 数据清洗入门", " 章节 3 数据清洗入门 Figure 3.1: dplyr包 数据清洗往往是我们数据研究中，耗时最长，最为繁琐的步骤。R语言最著名的开发者Hadley Wickham开发的一系列数据清洗的包（dplyr和tidyr），使得R语言数据清洗变得更加简单。今天我们小组将通过一个案例给大家演示如何在R语言中做中文数据清洗。 #导入相应的包 library(tidyverse) library(knitr) library(haven) library(labelled) library(lubridate) "],
["初识ggplot绘图.html", "章节 4 初识ggplot绘图 4.1 Example one 4.2 Example two", " 章节 4 初识ggplot绘图 Some significant applications are demonstrated in this chapter. 4.1 Example one 4.2 Example two "],
["概述性统计.html", "章节 5 概述性统计", " 章节 5 概述性统计 We have finished a nice book. "],
["建立初级回归模型.html", "章节 6 建立初级回归模型", " 章节 6 建立初级回归模型 "],
["建立高级回归模型.html", "章节 7 建立高级回归模型", " 章节 7 建立高级回归模型 "],
["文本挖掘.html", "章节 8 文本挖掘", " 章节 8 文本挖掘 "],
["r科研绘图.html", "章节 9 R科研绘图", " 章节 9 R科研绘图 "],
["r语言机器学习.html", "章节 10 R语言机器学习", " 章节 10 R语言机器学习 "],
["结构方程模型.html", "章节 11 结构方程模型", " 章节 11 结构方程模型 "],
["元分析.html", "章节 12 元分析", " 章节 12 元分析 "],
["因子分析.html", "章节 13 因子分析", " 章节 13 因子分析 "],
["推荐书目.html", "A 推荐书目", " A 推荐书目 "],
["引用.html", "引用", " 引用 Wickham, Hadley, Romain Fran?ois, Lionel Henry, and Kirill Müller. 2020. Dplyr: A Grammar of Data Manipulation. https://CRAN.R-project.org/package=dplyr. "]
]
